!function(t){t.address=function(){var e=function(e){return e=t.extend(t.Event(e),function(){for(var e={},r=t.address.parameterNames(),n=0,a=r.length;a>n;n++)e[r[n]]=t.address.parameter(r[n]);return{value:t.address.value(),path:t.address.path(),pathNames:t.address.pathNames(),parameterNames:r,parameters:e,queryString:t.address.queryString()}}.call(t.address)),t(t.address).trigger(e),e},r=function(t){return Array.prototype.slice.call(t)},n=function(){return t().bind.apply(t(t.address),Array.prototype.slice.call(arguments)),t.address},a=function(){return t().unbind.apply(t(t.address),Array.prototype.slice.call(arguments)),t.address},i=function(){return L.pushState&&q.state!==_},s=function(){return("/"+M.pathname.replace(new RegExp(q.state),"")+M.search+(o()?"#"+o():"")).replace(B,"/")},o=function(){var t=M.href.indexOf("#");return-1!=t?d(M.href.substr(t+1),j):""},c=function(){return i()?s():o()},u=function(){return"javascript"},l=function(t){return t=t.toString(),(q.strict&&"/"!=t.substr(0,1)?"/":"")+t},d=function(t,e){return q.crawlable&&e?(""!==t?"!":"")+t:t.replace(/^\!/,"")},p=function(t,e){return parseInt(t.css(e),10)},h=function(){if(!H){var t=c();decodeURI(Y)!=decodeURI(t)&&(O&&7>N?M.reload():(O&&!P&&q.history&&z(v,50),_old=Y,Y=t,f(j)))}},f=function(t){var r=e(I);t=e(t?R:U),z(m,10),(r.isDefaultPrevented()||t.isDefaultPrevented())&&g()},g=function(){Y=_old,i()?L.popState({},"",q.state.replace(/\/$/,"")+(""===Y?"/":Y)):(H=$,T?q.history?M.hash="#"+d(Y,$):M.replace("#"+d(Y,$)):Y!=c()&&(q.history?M.hash="#"+d(Y,$):M.replace("#"+d(Y,$))),O&&!P&&q.history&&z(v,50),T?z(function(){H=j},1):H=j)},m=function(){if("null"!==q.tracker&&q.tracker!==k){var e=t.isFunction(q.tracker)?q.tracker:C[q.tracker],r=(M.pathname+M.search+(t.address&&!i()?t.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");t.isFunction(e)?e(r):t.isFunction(C.urchinTracker)?C.urchinTracker(r):C.pageTracker!==_&&t.isFunction(C.pageTracker._trackPageview)?C.pageTracker._trackPageview(r):C._gaq!==_&&t.isFunction(C._gaq.push)&&C._gaq.push(["_trackPageview",decodeURI(r)])}},v=function(){var t=u()+":"+j+";document.open();document.writeln('<html><head><title>"+F.title.replace(/\'/g,"\\'")+"</title><script>var "+E+' = "'+encodeURIComponent(c()).replace(/\'/g,"\\'")+(F.domain!=M.hostname?'";document.domain="'+F.domain:"")+"\";</script></head></html>');document.close();";7>N?D.src=t:D.contentWindow.location.replace(t)},y=function(){if(K&&-1!=Q){var t,e,r=K.substr(Q+1).split("&");for(t=0;t<r.length;t++)e=r[t].split("="),/^(autoUpdate|crawlable|history|strict|wrap)$/.test(e[0])&&(q[e[0]]=isNaN(e[1])?/^(true|yes)$/i.test(e[1]):0!==parseInt(e[1],10)),/^(state|tracker)$/.test(e[0])&&(q[e[0]]=e[1]);K=k}_old=Y,Y=c()},w=function(){if(!J){J=$,y();var r=function(){b.call(this),x.call(this)},n=t("body").ajaxComplete(r);r(),q.wrap&&(t("body > *").wrapAll('<div style="padding:'+(p(n,"marginTop")+p(n,"paddingTop"))+"px "+(p(n,"marginRight")+p(n,"paddingRight"))+"px "+(p(n,"marginBottom")+p(n,"paddingBottom"))+"px "+(p(n,"marginLeft")+p(n,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+E+'" style="height:100%;overflow:auto;position:relative;'+(T&&!window.statusbar.visible?"resize:both;":"")+'" />'),t("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"}),T&&t('<style type="text/css" />').appendTo("head").text("#"+E+"::-webkit-resizer { background-color: #fff; }")),O&&!P&&(r=F.getElementsByTagName("frameset")[0],D=F.createElement((r?"":"i")+"frame"),D.src=u()+":"+j,r?(r.insertAdjacentElement("beforeEnd",D),r[r.cols?"cols":"rows"]+=",0",D.noResize=$,D.frameBorder=D.frameSpacing=0):(D.style.display="none",D.style.width=D.style.height=0,D.tabIndex=-1,F.body.insertAdjacentElement("afterBegin",D)),z(function(){t(D).bind("load",function(){var t=D.contentWindow;_old=Y,Y=t[E]!==_?t[E]:"",Y!=c()&&(f(j),M.hash=d(Y,$))}),D.contentWindow[E]===_&&v()},50)),z(function(){e("init"),f(j)},1),i()||(O&&N>7||!O&&P?C.addEventListener?C.addEventListener(S,h,j):C.attachEvent&&C.attachEvent("on"+S,h):W(h,50)),"state"in window.history&&t(window).trigger("popstate")}},b=function(){var e,r=t("a"),n=r.size(),a=-1,i=function(){++a!=n&&(e=t(r.get(a)),e.is('[rel*="address:"]')&&e.address('[rel*="address:"]'),z(i,1))};z(i,1)},x=function(){if(q.crawlable){var e=M.pathname.replace(/\/$/,"");-1!=t("body").html().indexOf("_escaped_fragment_")&&t('a[href]:not([href^=http]), a[href*="'+document.domain+'"]').each(function(){var r=t(this).attr("href").replace(/^http:/,"").replace(new RegExp(e+"/?$"),"");(""===r||-1!=r.indexOf("_escaped_fragment_"))&&t(this).attr("href","#"+encodeURI(decodeURIComponent(r.replace(/\/(.*)\?_escaped_fragment_=(.*)$/,"!$2"))))})}},_,k=null,E="jQueryAddress",S="hashchange",I="change",R="internalChange",U="externalChange",$=!0,j=!1,q={autoUpdate:$,crawlable:j,history:$,strict:$,wrap:j},A=t.browser,N=parseFloat(A.version),O=!t.support.opacity,T=A.webkit||A.safari,C=function(){try{return top.document!==_&&top.document.title!==_?top:window}catch(t){return window}}(),F=C.document,L=C.history,M=C.location,W=setInterval,z=setTimeout,B=/\/{2,9}/g;A=navigator.userAgent;var P="on"+S in C,D,K=t("script:last").attr("src"),Q=K?K.indexOf("?"):-1,G=F.title,H=j,J=j,V=$,X=j,Y=c();if(_old=Y,O){N=parseFloat(A.substr(A.indexOf("MSIE")+4)),F.documentMode&&F.documentMode!=N&&(N=8!=F.documentMode?7:8);var Z=F.onpropertychange;F.onpropertychange=function(){Z&&Z.call(F),F.title!=G&&-1!=F.title.indexOf("#"+c())&&(F.title=G)}}if(L.navigationMode&&(L.navigationMode="compatible"),"complete"==document.readyState)var te=setInterval(function(){t.address&&(w(),clearInterval(te))},50);else y(),t(w);return t(window).bind("popstate",function(){decodeURI(Y)!=decodeURI(c())&&(_old=Y,Y=c(),f(j))}).bind("unload",function(){C.removeEventListener?C.removeEventListener(S,h,j):C.detachEvent&&C.detachEvent("on"+S,h)}),{bind:function(){return n.apply(this,r(arguments))},unbind:function(){return a.apply(this,r(arguments))},init:function(){return n.apply(this,["init"].concat(r(arguments)))},change:function(){return n.apply(this,[I].concat(r(arguments)))},internalChange:function(){return n.apply(this,[R].concat(r(arguments)))},externalChange:function(){return n.apply(this,[U].concat(r(arguments)))},baseURL:function(){var t=M.href;return-1!=t.indexOf("#")&&(t=t.substr(0,t.indexOf("#"))),/\/$/.test(t)&&(t=t.substr(0,t.length-1)),t},autoUpdate:function(t){return t!==_?(q.autoUpdate=t,this):q.autoUpdate},crawlable:function(t){return t!==_?(q.crawlable=t,this):q.crawlable},history:function(t){return t!==_?(q.history=t,this):q.history},state:function(t){if(t!==_){q.state=t;var e=s();return q.state!==_&&(L.pushState?"/#/"==e.substr(0,3)&&M.replace(q.state.replace(/^\/$/,"")+e.substr(2)):"/"!=e&&e.replace(/^\/#/,"")!=o()&&z(function(){M.replace(q.state.replace(/^\/$/,"")+"/#"+e)},1)),this}return q.state},strict:function(t){return t!==_?(q.strict=t,this):q.strict},tracker:function(t){return t!==_?(q.tracker=t,this):q.tracker},wrap:function(t){return t!==_?(q.wrap=t,this):q.wrap},update:function(){return X=$,this.value(Y),X=j,this},title:function(t){return t!==_?(z(function(){G=F.title=t,V&&D&&D.contentWindow&&D.contentWindow.document&&(D.contentWindow.document.title=t,V=j)},50),this):F.title},value:function(t){if(t!==_){if(t=l(t),"/"==t&&(t=""),Y==t&&!X)return;return _old=Y,Y=t,(q.autoUpdate||X)&&(f($),i()?L[q.history?"pushState":"replaceState"]({},"",q.state.replace(/\/$/,"")+(""===Y?"/":Y)):(H=$,T?q.history?M.hash="#"+d(Y,$):M.replace("#"+d(Y,$)):Y!=c()&&(q.history?M.hash="#"+d(Y,$):M.replace("#"+d(Y,$))),O&&!P&&q.history&&z(v,50),T?z(function(){H=j},1):H=j)),this}return l(Y)},path:function(t){if(t!==_){var e=this.queryString(),r=this.hash();return this.value(t+(e?"?"+e:"")+(r?"#"+r:"")),this}return l(Y).split("#")[0].split("?")[0]},pathNames:function(){var t=this.path(),e=t.replace(B,"/").split("/");return("/"==t.substr(0,1)||0===t.length)&&e.splice(0,1),"/"==t.substr(t.length-1,1)&&e.splice(e.length-1,1),e},queryString:function(t){if(t!==_){var e=this.hash();return this.value(this.path()+(t?"?"+t:"")+(e?"#"+e:"")),this}return t=Y.split("?"),t.slice(1,t.length).join("?").split("#")[0]},parameter:function(e,r,n){var a,i;if(r!==_){var s=this.parameterNames();for(i=[],r=r===_||r===k?"":r.toString(),a=0;a<s.length;a++){var o=s[a],c=this.parameter(o);"string"==typeof c&&(c=[c]),o==e&&(c=r===k||""===r?[]:n?c.concat([r]):[r]);for(var u=0;u<c.length;u++)i.push(o+"="+c[u])}return-1==t.inArray(e,s)&&r!==k&&""!==r&&i.push(e+"="+r),this.queryString(i.join("&")),this}if(r=this.queryString()){for(n=[],i=r.split("&"),a=0;a<i.length;a++)r=i[a].split("="),r[0]==e&&n.push(r.slice(1).join("="));if(0!==n.length)return 1!=n.length?n:n[0]}},parameterNames:function(){var e=this.queryString(),r=[];if(e&&-1!=e.indexOf("=")){e=e.split("&");for(var n=0;n<e.length;n++){var a=e[n].split("=")[0];-1==t.inArray(a,r)&&r.push(a)}}return r},hash:function(t){return t!==_?(this.value(Y.split("#")[0]+(t?"#"+t:"")),this):(t=Y.split("#"),t.slice(1,t.length).join("#"))}}}(),t.fn.address=function(e){var r;return"string"==typeof e&&(r=e,e=void 0),t(this).attr("address")||t(r?r:this).live("click",function(r){return r.shiftKey||r.ctrlKey||r.metaKey||2==r.which?!0:void(t(this).is("a")&&(r.preventDefault(),r=e?e.call(this):/address:/.test(t(this).attr("rel"))?t(this).attr("rel").split("address:")[1].split(" ")[0]:void 0===t.address.state()||/^\/?$/.test(t.address.state())?t(this).attr("href").replace(/^(#\!?|\.)/,""):t(this).attr("href").replace(new RegExp("^(.*"+t.address.state()+"|\\.)"),""),t.address.value(r)))}).live("submit",function(r){t(this).is("form")&&(r.preventDefault(),r=t(this).attr("action"),r=e?e.call(this):(-1!=r.indexOf("?")?r.replace(/&$/,""):r+"?")+t(this).serialize(),t.address.value(r))}).attr("address",!0),this}}(jQuery);